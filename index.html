<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Niveau La Moine — Clisson</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0f1923;
            color: #e0e6ed;
            padding: 16px;
            max-width: 900px;
            margin: 0 auto;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 12px;
        }
        .station-name {
            font-size: 14px;
            color: #8899aa;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }
        .current-level {
            font-size: 48px;
            font-weight: 700;
            line-height: 1;
            margin: 4px 0;
        }
        .trend { font-size: 28px; margin-left: 8px; }
        .trend-up { color: #ff6b35; }
        .trend-down { color: #4ecdc4; }
        .trend-stable { color: #8899aa; }
        .meta {
            font-size: 12px;
            color: #5a6a7a;
            line-height: 1.6;
            text-align: right;
        }
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            margin-top: 6px;
        }
        .status-normal { background: rgba(78, 205, 196, 0.15); color: #4ecdc4; }
        .status-vigilance { background: rgba(255, 214, 0, 0.15); color: #ffd600; }
        .status-alert { background: rgba(255, 107, 53, 0.15); color: #ff6b35; }
        .chart-container {
            position: relative;
            width: 100%;
            height: 350px;
            margin-bottom: 16px;
        }
        .legend {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            font-size: 12px;
            color: #8899aa;
            justify-content: center;
        }
        .legend-item { display: flex; align-items: center; gap: 6px; }
        .legend-dot { width: 12px; height: 3px; border-radius: 2px; }
        .legend-area { width: 12px; height: 12px; border-radius: 2px; opacity: 0.4; }
        .footer {
            margin-top: 20px;
            text-align: center;
            font-size: 11px;
            color: #3a4a5a;
        }
        .footer a { color: #5a7a9a; text-decoration: none; }
    </style>
</head>
<body>

<div class="header">
    <div>
        <div class="station-name">La Moine à Clisson</div>
        <div class="current-level" id="currentLevel">—</div>
        <div class="status-badge status-normal" id="statusBadge">Normal</div>
    </div>
    <div class="meta">
        <div>Dernière mesure : <span id="lastObs">—</span></div>
        <div>Prévision du : <span id="lastSimul">—</span></div>
        <div>Page générée : <span id="updateTime">14/02/2026 02:30</span></div>
    </div>
</div>

<div class="chart-container">
    <canvas id="chart"></canvas>
</div>

<div class="legend">
    <div class="legend-item"><div class="legend-dot" style="background:#4ecdc4"></div> Observations</div>
    <div class="legend-item"><div class="legend-dot" style="background:#4ecdc4;opacity:0.5"></div> Prévision moy.</div>
    <div class="legend-item"><div class="legend-area" style="background:#4ecdc4"></div> Fourchette 80%</div>
    <div class="legend-item"><div class="legend-dot" style="background:#ff6b35"></div> Seuil surveillance (2.00m)</div>
</div>

<div class="footer">
    Données <a href="https://www.vigicrues.gouv.fr" target="_blank">Vigicrues</a> — Station M730242010
</div>

<script>
const obsData = [{"dt": "2026-02-06T22:10:00+00:00", "level": 0.98}, {"dt": "2026-02-06T22:20:00+00:00", "level": 0.98}, {"dt": "2026-02-06T22:30:00+00:00", "level": 0.98}, {"dt": "2026-02-06T22:40:00+00:00", "level": 0.97}, {"dt": "2026-02-06T22:50:00+00:00", "level": 0.97}, {"dt": "2026-02-06T23:00:00+00:00", "level": 0.97}, {"dt": "2026-02-06T23:10:00+00:00", "level": 0.97}, {"dt": "2026-02-06T23:20:00+00:00", "level": 0.97}, {"dt": "2026-02-06T23:30:00+00:00", "level": 0.96}, {"dt": "2026-02-06T23:40:00+00:00", "level": 0.97}, {"dt": "2026-02-06T23:50:00+00:00", "level": 0.96}, {"dt": "2026-02-07T00:00:00+00:00", "level": 0.97}, {"dt": "2026-02-07T00:10:00+00:00", "level": 0.97}, {"dt": "2026-02-07T00:20:00+00:00", "level": 0.97}, {"dt": "2026-02-07T00:30:00+00:00", "level": 0.97}, {"dt": "2026-02-07T00:40:00+00:00", "level": 0.96}, {"dt": "2026-02-07T00:50:00+00:00", "level": 0.96}, {"dt": "2026-02-07T01:00:00+00:00", "level": 0.96}, {"dt": "2026-02-07T01:10:00+00:00", "level": 0.96}, {"dt": "2026-02-07T01:20:00+00:00", "level": 0.96}, {"dt": "2026-02-07T01:30:00+00:00", "level": 0.96}, {"dt": "2026-02-07T01:40:00+00:00", "level": 0.96}, {"dt": "2026-02-07T01:50:00+00:00", "level": 0.96}, {"dt": "2026-02-07T02:00:00+00:00", "level": 0.96}, {"dt": "2026-02-07T02:10:00+00:00", "level": 0.96}, {"dt": "2026-02-07T02:20:00+00:00", "level": 0.96}, {"dt": "2026-02-07T02:30:00+00:00", "level": 0.96}, {"dt": "2026-02-07T02:40:00+00:00", "level": 0.97}, {"dt": "2026-02-07T02:50:00+00:00", "level": 0.96}, {"dt": "2026-02-07T03:00:00+00:00", "level": 0.96}, {"dt": "2026-02-07T03:10:00+00:00", "level": 0.96}, {"dt": "2026-02-07T03:20:00+00:00", "level": 0.97}, {"dt": "2026-02-07T03:30:00+00:00", "level": 0.97}, {"dt": "2026-02-07T03:40:00+00:00", "level": 0.97}, {"dt": "2026-02-07T03:50:00+00:00", "level": 0.97}, {"dt": "2026-02-07T04:00:00+00:00", "level": 0.97}, {"dt": "2026-02-07T04:10:00+00:00", "level": 0.97}, {"dt": "2026-02-07T04:20:00+00:00", "level": 0.97}, {"dt": "2026-02-07T04:30:00+00:00", "level": 0.97}, {"dt": "2026-02-07T04:40:00+00:00", "level": 0.97}, {"dt": "2026-02-07T04:50:00+00:00", "level": 0.96}, {"dt": "2026-02-07T05:00:00+00:00", "level": 0.97}, {"dt": "2026-02-07T05:10:00+00:00", "level": 0.97}, {"dt": "2026-02-07T05:20:00+00:00", "level": 0.97}, {"dt": "2026-02-07T05:30:00+00:00", "level": 0.97}, {"dt": "2026-02-07T05:40:00+00:00", "level": 0.97}, {"dt": "2026-02-07T05:50:00+00:00", "level": 0.96}, {"dt": "2026-02-07T06:00:00+00:00", "level": 0.96}, {"dt": "2026-02-07T06:10:00+00:00", "level": 0.96}, {"dt": "2026-02-07T06:20:00+00:00", "level": 0.96}, {"dt": "2026-02-07T06:30:00+00:00", "level": 0.96}, {"dt": "2026-02-07T06:40:00+00:00", "level": 0.96}, {"dt": "2026-02-07T06:50:00+00:00", "level": 0.96}, {"dt": "2026-02-07T07:00:00+00:00", "level": 0.96}, {"dt": "2026-02-07T07:10:00+00:00", "level": 0.96}, {"dt": "2026-02-07T07:20:00+00:00", "level": 0.96}, {"dt": "2026-02-07T07:30:00+00:00", "level": 0.96}, {"dt": "2026-02-07T07:40:00+00:00", "level": 0.96}, {"dt": "2026-02-07T07:50:00+00:00", "level": 0.95}, {"dt": "2026-02-07T08:00:00+00:00", "level": 0.95}, {"dt": "2026-02-07T08:10:00+00:00", "level": 0.95}, {"dt": "2026-02-07T08:20:00+00:00", "level": 0.95}, {"dt": "2026-02-07T08:30:00+00:00", "level": 0.95}, {"dt": "2026-02-07T08:40:00+00:00", "level": 0.95}, {"dt": "2026-02-07T08:50:00+00:00", "level": 0.95}, {"dt": "2026-02-07T09:00:00+00:00", "level": 0.95}, {"dt": "2026-02-07T09:10:00+00:00", "level": 0.95}, {"dt": "2026-02-07T09:20:00+00:00", "level": 0.94}, {"dt": "2026-02-07T09:30:00+00:00", "level": 0.94}, {"dt": "2026-02-07T09:40:00+00:00", "level": 0.94}, {"dt": "2026-02-07T09:50:00+00:00", "level": 0.94}, {"dt": "2026-02-07T10:00:00+00:00", "level": 0.94}, {"dt": "2026-02-07T10:10:00+00:00", "level": 0.94}, {"dt": "2026-02-07T10:20:00+00:00", "level": 0.94}, {"dt": "2026-02-07T10:30:00+00:00", "level": 0.94}, {"dt": "2026-02-07T10:40:00+00:00", "level": 0.93}, {"dt": "2026-02-07T10:50:00+00:00", "level": 0.93}, {"dt": "2026-02-07T11:00:00+00:00", "level": 0.93}, {"dt": "2026-02-07T11:10:00+00:00", "level": 0.93}, {"dt": "2026-02-07T11:20:00+00:00", "level": 0.93}, {"dt": "2026-02-07T11:30:00+00:00", "level": 0.92}, {"dt": "2026-02-07T11:40:00+00:00", "level": 0.92}, {"dt": "2026-02-07T11:50:00+00:00", "level": 0.92}, {"dt": "2026-02-07T12:00:00+00:00", "level": 0.92}, {"dt": "2026-02-07T12:10:00+00:00", "level": 0.92}, {"dt": "2026-02-07T12:20:00+00:00", "level": 0.92}, {"dt": "2026-02-07T12:30:00+00:00", "level": 0.92}, {"dt": "2026-02-07T12:40:00+00:00", "level": 0.92}, {"dt": "2026-02-07T12:50:00+00:00", "level": 0.91}, {"dt": "2026-02-07T13:00:00+00:00", "level": 0.91}, {"dt": "2026-02-07T13:10:00+00:00", "level": 0.91}, {"dt": "2026-02-07T13:20:00+00:00", "level": 0.91}, {"dt": "2026-02-07T13:30:00+00:00", "level": 0.91}, {"dt": "2026-02-07T13:40:00+00:00", "level": 0.91}, {"dt": "2026-02-07T13:50:00+00:00", "level": 0.91}, {"dt": "2026-02-07T14:00:00+00:00", "level": 0.9}, {"dt": "2026-02-07T14:10:00+00:00", "level": 0.9}, {"dt": "2026-02-07T14:20:00+00:00", "level": 0.9}, {"dt": "2026-02-07T14:30:00+00:00", "level": 0.9}, {"dt": "2026-02-07T14:40:00+00:00", "level": 0.9}, {"dt": "2026-02-07T14:50:00+00:00", "level": 0.9}, {"dt": "2026-02-07T15:00:00+00:00", "level": 0.9}, {"dt": "2026-02-07T15:10:00+00:00", "level": 0.9}, {"dt": "2026-02-07T15:20:00+00:00", "level": 0.89}, {"dt": "2026-02-07T15:30:00+00:00", "level": 0.89}, {"dt": "2026-02-07T15:40:00+00:00", "level": 0.89}, {"dt": "2026-02-07T15:50:00+00:00", "level": 0.89}, {"dt": "2026-02-07T16:00:00+00:00", "level": 0.89}, {"dt": "2026-02-07T16:10:00+00:00", "level": 0.89}, {"dt": "2026-02-07T16:20:00+00:00", "level": 0.88}, {"dt": "2026-02-07T16:30:00+00:00", "level": 0.88}, {"dt": "2026-02-07T16:40:00+00:00", "level": 0.88}, {"dt": "2026-02-07T16:50:00+00:00", "level": 0.88}, {"dt": "2026-02-07T17:00:00+00:00", "level": 0.88}, {"dt": "2026-02-07T17:10:00+00:00", "level": 0.88}, {"dt": "2026-02-07T17:20:00+00:00", "level": 0.88}, {"dt": "2026-02-07T17:30:00+00:00", "level": 0.87}, {"dt": "2026-02-07T17:40:00+00:00", "level": 0.87}, {"dt": "2026-02-07T17:50:00+00:00", "level": 0.87}, {"dt": "2026-02-07T18:00:00+00:00", "level": 0.87}, {"dt": "2026-02-07T18:10:00+00:00", "level": 0.87}, {"dt": "2026-02-07T18:20:00+00:00", "level": 0.86}, {"dt": "2026-02-07T18:30:00+00:00", "level": 0.86}, {"dt": "2026-02-07T18:40:00+00:00", "level": 0.86}, {"dt": "2026-02-07T18:50:00+00:00", "level": 0.86}, {"dt": "2026-02-07T19:00:00+00:00", "level": 0.86}, {"dt": "2026-02-07T19:10:00+00:00", "level": 0.86}, {"dt": "2026-02-07T19:20:00+00:00", "level": 0.86}, {"dt": "2026-02-07T19:30:00+00:00", "level": 0.86}, {"dt": "2026-02-07T19:40:00+00:00", "level": 0.85}, {"dt": "2026-02-07T19:50:00+00:00", "level": 0.85}, {"dt": "2026-02-07T20:00:00+00:00", "level": 0.85}, {"dt": "2026-02-07T20:10:00+00:00", "level": 0.85}, {"dt": "2026-02-07T20:20:00+00:00", "level": 0.85}, {"dt": "2026-02-07T20:30:00+00:00", "level": 0.85}, {"dt": "2026-02-07T20:40:00+00:00", "level": 0.84}, {"dt": "2026-02-07T20:50:00+00:00", "level": 0.84}, {"dt": "2026-02-07T21:00:00+00:00", "level": 0.84}, {"dt": "2026-02-07T21:10:00+00:00", "level": 0.84}, {"dt": "2026-02-07T21:20:00+00:00", "level": 0.84}, {"dt": "2026-02-07T21:30:00+00:00", "level": 0.84}, {"dt": "2026-02-07T21:40:00+00:00", "level": 0.84}, {"dt": "2026-02-07T21:50:00+00:00", "level": 0.84}, {"dt": "2026-02-07T22:00:00+00:00", "level": 0.83}, {"dt": "2026-02-07T22:10:00+00:00", "level": 0.83}, {"dt": "2026-02-07T22:20:00+00:00", "level": 0.83}, {"dt": "2026-02-07T22:30:00+00:00", "level": 0.83}, {"dt": "2026-02-07T22:40:00+00:00", "level": 0.83}, {"dt": "2026-02-07T22:50:00+00:00", "level": 0.83}, {"dt": "2026-02-07T23:00:00+00:00", "level": 0.83}, {"dt": "2026-02-07T23:10:00+00:00", "level": 0.82}, {"dt": "2026-02-07T23:20:00+00:00", "level": 0.82}, {"dt": "2026-02-07T23:30:00+00:00", "level": 0.82}, {"dt": "2026-02-07T23:40:00+00:00", "level": 0.82}, {"dt": "2026-02-07T23:50:00+00:00", "level": 0.82}, {"dt": "2026-02-08T00:00:00+00:00", "level": 0.82}, {"dt": "2026-02-08T01:00:00+00:00", "level": 0.81}, {"dt": "2026-02-08T02:00:00+00:00", "level": 0.81}, {"dt": "2026-02-08T03:00:00+00:00", "level": 0.81}, {"dt": "2026-02-08T04:00:00+00:00", "level": 0.8}, {"dt": "2026-02-08T05:00:00+00:00", "level": 0.79}, {"dt": "2026-02-08T06:00:00+00:00", "level": 0.78}, {"dt": "2026-02-08T07:00:00+00:00", "level": 0.77}, {"dt": "2026-02-08T08:00:00+00:00", "level": 0.76}, {"dt": "2026-02-08T09:00:00+00:00", "level": 0.75}, {"dt": "2026-02-08T10:00:00+00:00", "level": 0.74}, {"dt": "2026-02-08T11:00:00+00:00", "level": 0.73}, {"dt": "2026-02-08T12:00:00+00:00", "level": 0.72}, {"dt": "2026-02-08T13:00:00+00:00", "level": 0.72}, {"dt": "2026-02-08T14:00:00+00:00", "level": 0.71}, {"dt": "2026-02-08T15:00:00+00:00", "level": 0.7}, {"dt": "2026-02-08T16:00:00+00:00", "level": 0.7}, {"dt": "2026-02-08T17:00:00+00:00", "level": 0.69}, {"dt": "2026-02-08T18:00:00+00:00", "level": 0.68}, {"dt": "2026-02-08T19:00:00+00:00", "level": 0.68}, {"dt": "2026-02-08T20:00:00+00:00", "level": 0.67}, {"dt": "2026-02-08T21:00:00+00:00", "level": 0.67}, {"dt": "2026-02-08T22:00:00+00:00", "level": 0.66}, {"dt": "2026-02-08T23:00:00+00:00", "level": 0.65}, {"dt": "2026-02-09T00:00:00+00:00", "level": 0.65}, {"dt": "2026-02-09T01:00:00+00:00", "level": 0.64}, {"dt": "2026-02-09T02:00:00+00:00", "level": 0.64}, {"dt": "2026-02-09T03:00:00+00:00", "level": 0.63}, {"dt": "2026-02-09T04:00:00+00:00", "level": 0.63}, {"dt": "2026-02-09T05:00:00+00:00", "level": 0.62}, {"dt": "2026-02-09T06:00:00+00:00", "level": 0.62}, {"dt": "2026-02-09T07:00:00+00:00", "level": 0.61}, {"dt": "2026-02-09T08:00:00+00:00", "level": 0.6}, {"dt": "2026-02-09T09:00:00+00:00", "level": 0.6}, {"dt": "2026-02-09T10:00:00+00:00", "level": 0.6}, {"dt": "2026-02-09T11:00:00+00:00", "level": 0.62}, {"dt": "2026-02-09T12:00:00+00:00", "level": 0.63}, {"dt": "2026-02-09T13:00:00+00:00", "level": 0.6}, {"dt": "2026-02-09T14:00:00+00:00", "level": 0.57}, {"dt": "2026-02-09T15:00:00+00:00", "level": 0.56}, {"dt": "2026-02-09T16:00:00+00:00", "level": 0.56}, {"dt": "2026-02-09T17:00:00+00:00", "level": 0.56}, {"dt": "2026-02-09T18:00:00+00:00", "level": 0.58}, {"dt": "2026-02-09T19:00:00+00:00", "level": 0.56}, {"dt": "2026-02-09T20:00:00+00:00", "level": 0.56}, {"dt": "2026-02-09T21:00:00+00:00", "level": 0.59}, {"dt": "2026-02-09T22:00:00+00:00", "level": 0.61}, {"dt": "2026-02-09T23:00:00+00:00", "level": 0.63}, {"dt": "2026-02-10T00:00:00+00:00", "level": 0.65}, {"dt": "2026-02-10T01:00:00+00:00", "level": 0.67}, {"dt": "2026-02-10T02:00:00+00:00", "level": 0.7}, {"dt": "2026-02-10T03:00:00+00:00", "level": 0.72}, {"dt": "2026-02-10T04:00:00+00:00", "level": 0.75}, {"dt": "2026-02-10T05:00:00+00:00", "level": 0.77}, {"dt": "2026-02-10T06:00:00+00:00", "level": 0.78}, {"dt": "2026-02-10T07:00:00+00:00", "level": 0.8}, {"dt": "2026-02-10T08:00:00+00:00", "level": 0.83}, {"dt": "2026-02-10T09:00:00+00:00", "level": 0.84}, {"dt": "2026-02-10T10:00:00+00:00", "level": 0.87}, {"dt": "2026-02-10T11:00:00+00:00", "level": 0.91}, {"dt": "2026-02-10T12:00:00+00:00", "level": 0.95}, {"dt": "2026-02-10T13:00:00+00:00", "level": 0.98}, {"dt": "2026-02-10T14:00:00+00:00", "level": 1.02}, {"dt": "2026-02-10T15:00:00+00:00", "level": 1.06}, {"dt": "2026-02-10T16:00:00+00:00", "level": 1.07}, {"dt": "2026-02-10T17:00:00+00:00", "level": 1.11}, {"dt": "2026-02-10T18:00:00+00:00", "level": 1.15}, {"dt": "2026-02-10T19:00:00+00:00", "level": 1.18}, {"dt": "2026-02-10T20:00:00+00:00", "level": 1.2}, {"dt": "2026-02-10T21:00:00+00:00", "level": 1.24}, {"dt": "2026-02-10T22:00:00+00:00", "level": 1.29}, {"dt": "2026-02-10T23:00:00+00:00", "level": 1.34}, {"dt": "2026-02-11T00:00:00+00:00", "level": 1.39}, {"dt": "2026-02-11T01:00:00+00:00", "level": 1.45}, {"dt": "2026-02-11T02:00:00+00:00", "level": 1.5}, {"dt": "2026-02-11T03:00:00+00:00", "level": 1.54}, {"dt": "2026-02-11T04:00:00+00:00", "level": 1.58}, {"dt": "2026-02-11T05:00:00+00:00", "level": 1.6}, {"dt": "2026-02-11T06:00:00+00:00", "level": 1.6}, {"dt": "2026-02-11T07:00:00+00:00", "level": 1.6}, {"dt": "2026-02-11T08:00:00+00:00", "level": 1.58}, {"dt": "2026-02-11T09:00:00+00:00", "level": 1.57}, {"dt": "2026-02-11T10:00:00+00:00", "level": 1.56}, {"dt": "2026-02-11T11:00:00+00:00", "level": 1.56}, {"dt": "2026-02-11T12:00:00+00:00", "level": 1.55}, {"dt": "2026-02-11T13:00:00+00:00", "level": 1.55}, {"dt": "2026-02-11T14:00:00+00:00", "level": 1.53}, {"dt": "2026-02-11T15:00:00+00:00", "level": 1.53}, {"dt": "2026-02-11T16:00:00+00:00", "level": 1.53}, {"dt": "2026-02-11T17:00:00+00:00", "level": 1.53}, {"dt": "2026-02-11T18:00:00+00:00", "level": 1.55}, {"dt": "2026-02-11T19:00:00+00:00", "level": 1.57}, {"dt": "2026-02-11T20:00:00+00:00", "level": 1.61}, {"dt": "2026-02-11T21:00:00+00:00", "level": 1.63}, {"dt": "2026-02-11T22:00:00+00:00", "level": 1.67}, {"dt": "2026-02-11T23:00:00+00:00", "level": 1.69}, {"dt": "2026-02-12T00:00:00+00:00", "level": 1.7}, {"dt": "2026-02-12T01:00:00+00:00", "level": 1.72}, {"dt": "2026-02-12T02:00:00+00:00", "level": 1.73}, {"dt": "2026-02-12T03:00:00+00:00", "level": 1.74}, {"dt": "2026-02-12T04:00:00+00:00", "level": 1.76}, {"dt": "2026-02-12T05:00:00+00:00", "level": 1.75}, {"dt": "2026-02-12T06:00:00+00:00", "level": 1.77}, {"dt": "2026-02-12T07:00:00+00:00", "level": 1.76}, {"dt": "2026-02-12T08:00:00+00:00", "level": 1.76}, {"dt": "2026-02-12T09:00:00+00:00", "level": 1.75}, {"dt": "2026-02-12T10:00:00+00:00", "level": 1.74}, {"dt": "2026-02-12T11:00:00+00:00", "level": 1.73}, {"dt": "2026-02-12T12:00:00+00:00", "level": 1.7}, {"dt": "2026-02-12T13:00:00+00:00", "level": 1.69}, {"dt": "2026-02-12T14:00:00+00:00", "level": 1.67}, {"dt": "2026-02-12T15:00:00+00:00", "level": 1.65}, {"dt": "2026-02-12T16:00:00+00:00", "level": 1.63}, {"dt": "2026-02-12T17:00:00+00:00", "level": 1.6}, {"dt": "2026-02-12T18:00:00+00:00", "level": 1.59}, {"dt": "2026-02-12T19:00:00+00:00", "level": 1.58}, {"dt": "2026-02-12T20:00:00+00:00", "level": 1.58}, {"dt": "2026-02-12T21:00:00+00:00", "level": 1.58}, {"dt": "2026-02-12T22:00:00+00:00", "level": 1.59}, {"dt": "2026-02-12T23:00:00+00:00", "level": 1.59}, {"dt": "2026-02-13T00:00:00+00:00", "level": 1.59}, {"dt": "2026-02-13T00:10:00+00:00", "level": 1.59}, {"dt": "2026-02-13T00:20:00+00:00", "level": 1.59}, {"dt": "2026-02-13T00:30:00+00:00", "level": 1.59}, {"dt": "2026-02-13T00:40:00+00:00", "level": 1.6}, {"dt": "2026-02-13T00:50:00+00:00", "level": 1.59}, {"dt": "2026-02-13T01:00:00+00:00", "level": 1.59}, {"dt": "2026-02-13T01:10:00+00:00", "level": 1.59}, {"dt": "2026-02-13T01:20:00+00:00", "level": 1.59}, {"dt": "2026-02-13T01:30:00+00:00", "level": 1.58}, {"dt": "2026-02-13T01:40:00+00:00", "level": 1.58}, {"dt": "2026-02-13T01:50:00+00:00", "level": 1.58}, {"dt": "2026-02-13T02:00:00+00:00", "level": 1.58}, {"dt": "2026-02-13T02:10:00+00:00", "level": 1.57}, {"dt": "2026-02-13T02:20:00+00:00", "level": 1.57}, {"dt": "2026-02-13T02:30:00+00:00", "level": 1.57}, {"dt": "2026-02-13T02:40:00+00:00", "level": 1.57}, {"dt": "2026-02-13T02:50:00+00:00", "level": 1.56}, {"dt": "2026-02-13T03:00:00+00:00", "level": 1.56}, {"dt": "2026-02-13T03:10:00+00:00", "level": 1.55}, {"dt": "2026-02-13T03:20:00+00:00", "level": 1.55}, {"dt": "2026-02-13T03:30:00+00:00", "level": 1.55}, {"dt": "2026-02-13T03:40:00+00:00", "level": 1.55}, {"dt": "2026-02-13T03:50:00+00:00", "level": 1.54}, {"dt": "2026-02-13T04:00:00+00:00", "level": 1.54}, {"dt": "2026-02-13T04:10:00+00:00", "level": 1.54}, {"dt": "2026-02-13T04:20:00+00:00", "level": 1.54}, {"dt": "2026-02-13T04:30:00+00:00", "level": 1.53}, {"dt": "2026-02-13T04:40:00+00:00", "level": 1.53}, {"dt": "2026-02-13T04:50:00+00:00", "level": 1.53}, {"dt": "2026-02-13T05:00:00+00:00", "level": 1.53}, {"dt": "2026-02-13T05:10:00+00:00", "level": 1.52}, {"dt": "2026-02-13T05:20:00+00:00", "level": 1.52}, {"dt": "2026-02-13T05:30:00+00:00", "level": 1.52}, {"dt": "2026-02-13T05:40:00+00:00", "level": 1.51}, {"dt": "2026-02-13T05:50:00+00:00", "level": 1.51}, {"dt": "2026-02-13T06:00:00+00:00", "level": 1.51}, {"dt": "2026-02-13T06:10:00+00:00", "level": 1.5}, {"dt": "2026-02-13T06:20:00+00:00", "level": 1.5}, {"dt": "2026-02-13T06:30:00+00:00", "level": 1.51}, {"dt": "2026-02-13T06:40:00+00:00", "level": 1.5}, {"dt": "2026-02-13T06:50:00+00:00", "level": 1.5}, {"dt": "2026-02-13T07:00:00+00:00", "level": 1.5}, {"dt": "2026-02-13T07:10:00+00:00", "level": 1.5}, {"dt": "2026-02-13T07:20:00+00:00", "level": 1.5}, {"dt": "2026-02-13T07:30:00+00:00", "level": 1.5}, {"dt": "2026-02-13T07:40:00+00:00", "level": 1.5}, {"dt": "2026-02-13T07:50:00+00:00", "level": 1.5}, {"dt": "2026-02-13T08:00:00+00:00", "level": 1.5}, {"dt": "2026-02-13T08:10:00+00:00", "level": 1.5}, {"dt": "2026-02-13T08:20:00+00:00", "level": 1.5}, {"dt": "2026-02-13T08:30:00+00:00", "level": 1.5}, {"dt": "2026-02-13T08:40:00+00:00", "level": 1.51}, {"dt": "2026-02-13T08:50:00+00:00", "level": 1.51}, {"dt": "2026-02-13T09:00:00+00:00", "level": 1.51}, {"dt": "2026-02-13T09:10:00+00:00", "level": 1.51}, {"dt": "2026-02-13T09:20:00+00:00", "level": 1.52}, {"dt": "2026-02-13T09:30:00+00:00", "level": 1.52}, {"dt": "2026-02-13T09:40:00+00:00", "level": 1.52}, {"dt": "2026-02-13T09:50:00+00:00", "level": 1.53}, {"dt": "2026-02-13T10:00:00+00:00", "level": 1.53}, {"dt": "2026-02-13T10:10:00+00:00", "level": 1.54}, {"dt": "2026-02-13T10:20:00+00:00", "level": 1.54}, {"dt": "2026-02-13T10:30:00+00:00", "level": 1.54}, {"dt": "2026-02-13T10:40:00+00:00", "level": 1.55}, {"dt": "2026-02-13T10:50:00+00:00", "level": 1.55}, {"dt": "2026-02-13T11:00:00+00:00", "level": 1.55}, {"dt": "2026-02-13T11:10:00+00:00", "level": 1.55}, {"dt": "2026-02-13T11:20:00+00:00", "level": 1.55}, {"dt": "2026-02-13T11:30:00+00:00", "level": 1.56}, {"dt": "2026-02-13T11:40:00+00:00", "level": 1.56}, {"dt": "2026-02-13T11:50:00+00:00", "level": 1.57}, {"dt": "2026-02-13T12:00:00+00:00", "level": 1.57}, {"dt": "2026-02-13T12:10:00+00:00", "level": 1.57}, {"dt": "2026-02-13T12:20:00+00:00", "level": 1.57}, {"dt": "2026-02-13T12:30:00+00:00", "level": 1.57}, {"dt": "2026-02-13T12:40:00+00:00", "level": 1.57}, {"dt": "2026-02-13T12:50:00+00:00", "level": 1.57}, {"dt": "2026-02-13T13:00:00+00:00", "level": 1.57}, {"dt": "2026-02-13T13:10:00+00:00", "level": 1.57}, {"dt": "2026-02-13T13:20:00+00:00", "level": 1.57}, {"dt": "2026-02-13T13:30:00+00:00", "level": 1.58}, {"dt": "2026-02-13T13:40:00+00:00", "level": 1.58}, {"dt": "2026-02-13T13:50:00+00:00", "level": 1.59}, {"dt": "2026-02-13T14:00:00+00:00", "level": 1.59}, {"dt": "2026-02-13T14:10:00+00:00", "level": 1.59}, {"dt": "2026-02-13T14:20:00+00:00", "level": 1.6}, {"dt": "2026-02-13T14:30:00+00:00", "level": 1.6}, {"dt": "2026-02-13T14:40:00+00:00", "level": 1.6}, {"dt": "2026-02-13T14:50:00+00:00", "level": 1.61}, {"dt": "2026-02-13T15:00:00+00:00", "level": 1.61}, {"dt": "2026-02-13T15:10:00+00:00", "level": 1.62}, {"dt": "2026-02-13T15:20:00+00:00", "level": 1.63}, {"dt": "2026-02-13T15:30:00+00:00", "level": 1.63}, {"dt": "2026-02-13T15:40:00+00:00", "level": 1.63}, {"dt": "2026-02-13T15:50:00+00:00", "level": 1.63}, {"dt": "2026-02-13T16:00:00+00:00", "level": 1.65}, {"dt": "2026-02-13T16:10:00+00:00", "level": 1.65}, {"dt": "2026-02-13T16:20:00+00:00", "level": 1.66}, {"dt": "2026-02-13T16:30:00+00:00", "level": 1.66}, {"dt": "2026-02-13T16:40:00+00:00", "level": 1.67}, {"dt": "2026-02-13T16:50:00+00:00", "level": 1.67}, {"dt": "2026-02-13T17:00:00+00:00", "level": 1.68}, {"dt": "2026-02-13T17:10:00+00:00", "level": 1.68}, {"dt": "2026-02-13T17:20:00+00:00", "level": 1.69}, {"dt": "2026-02-13T17:30:00+00:00", "level": 1.68}, {"dt": "2026-02-13T17:40:00+00:00", "level": 1.7}, {"dt": "2026-02-13T17:50:00+00:00", "level": 1.7}, {"dt": "2026-02-13T18:00:00+00:00", "level": 1.71}, {"dt": "2026-02-13T18:10:00+00:00", "level": 1.7}, {"dt": "2026-02-13T18:20:00+00:00", "level": 1.7}, {"dt": "2026-02-13T18:30:00+00:00", "level": 1.7}, {"dt": "2026-02-13T18:40:00+00:00", "level": 1.7}, {"dt": "2026-02-13T18:50:00+00:00", "level": 1.69}, {"dt": "2026-02-13T19:00:00+00:00", "level": 1.7}, {"dt": "2026-02-13T19:10:00+00:00", "level": 1.69}, {"dt": "2026-02-13T19:20:00+00:00", "level": 1.7}, {"dt": "2026-02-13T19:30:00+00:00", "level": 1.7}, {"dt": "2026-02-13T19:40:00+00:00", "level": 1.69}, {"dt": "2026-02-13T19:50:00+00:00", "level": 1.7}, {"dt": "2026-02-13T20:00:00+00:00", "level": 1.68}, {"dt": "2026-02-13T20:10:00+00:00", "level": 1.69}, {"dt": "2026-02-13T20:20:00+00:00", "level": 1.68}, {"dt": "2026-02-13T20:30:00+00:00", "level": 1.68}, {"dt": "2026-02-13T20:40:00+00:00", "level": 1.68}, {"dt": "2026-02-13T20:50:00+00:00", "level": 1.67}, {"dt": "2026-02-13T21:00:00+00:00", "level": 1.67}, {"dt": "2026-02-13T21:10:00+00:00", "level": 1.66}, {"dt": "2026-02-13T21:20:00+00:00", "level": 1.65}, {"dt": "2026-02-13T21:30:00+00:00", "level": 1.66}, {"dt": "2026-02-13T21:40:00+00:00", "level": 1.65}, {"dt": "2026-02-13T21:50:00+00:00", "level": 1.64}, {"dt": "2026-02-13T22:00:00+00:00", "level": 1.64}, {"dt": "2026-02-13T22:10:00+00:00", "level": 1.64}, {"dt": "2026-02-13T22:20:00+00:00", "level": 1.63}, {"dt": "2026-02-13T22:30:00+00:00", "level": 1.63}, {"dt": "2026-02-13T22:40:00+00:00", "level": 1.62}, {"dt": "2026-02-13T22:50:00+00:00", "level": 1.61}, {"dt": "2026-02-13T23:00:00+00:00", "level": 1.61}, {"dt": "2026-02-13T23:10:00+00:00", "level": 1.6}, {"dt": "2026-02-13T23:20:00+00:00", "level": 1.59}, {"dt": "2026-02-13T23:30:00+00:00", "level": 1.6}, {"dt": "2026-02-13T23:40:00+00:00", "level": 1.59}, {"dt": "2026-02-13T23:50:00+00:00", "level": 1.59}, {"dt": "2026-02-14T00:00:00+00:00", "level": 1.58}, {"dt": "2026-02-14T00:10:00+00:00", "level": 1.57}, {"dt": "2026-02-14T00:20:00+00:00", "level": 1.57}, {"dt": "2026-02-14T00:30:00+00:00", "level": 1.56}, {"dt": "2026-02-14T00:40:00+00:00", "level": 1.56}, {"dt": "2026-02-14T00:50:00+00:00", "level": 1.56}, {"dt": "2026-02-14T01:00:00+00:00", "level": 1.55}, {"dt": "2026-02-14T01:10:00+00:00", "level": 1.54}, {"dt": "2026-02-14T01:20:00+00:00", "level": 1.54}, {"dt": "2026-02-14T01:30:00+00:00", "level": 1.53}, {"dt": "2026-02-14T01:40:00+00:00", "level": 1.53}, {"dt": "2026-02-14T01:50:00+00:00", "level": 1.53}, {"dt": "2026-02-14T02:00:00+00:00", "level": 1.52}];
const prevData = {"dt_prod": "2026-02-13T16:58:04+00:00", "prevs": [{"dt": "2026-02-14T02:19:00+00:00", "min": 1.29, "moy": 1.53, "max": 1.8}, {"dt": "2026-02-14T03:19:00+00:00", "min": 1.26, "moy": 1.5, "max": 1.77}, {"dt": "2026-02-14T04:19:00+00:00", "min": 1.23, "moy": 1.48, "max": 1.75}, {"dt": "2026-02-14T05:19:01+00:00", "min": 1.2, "moy": 1.46, "max": 1.72}, {"dt": "2026-02-14T06:19:02+00:00", "min": 1.17, "moy": 1.43, "max": 1.69}, {"dt": "2026-02-14T07:19:04+00:00", "min": 1.14, "moy": 1.41, "max": 1.66}, {"dt": "2026-02-14T08:19:07+00:00", "min": 1.11, "moy": 1.38, "max": 1.63}, {"dt": "2026-02-14T09:19:10+00:00", "min": 1.08, "moy": 1.35, "max": 1.6}, {"dt": "2026-02-14T10:19:13+00:00", "min": 1.05, "moy": 1.33, "max": 1.58}, {"dt": "2026-02-14T11:19:16+00:00", "min": 1.03, "moy": 1.3, "max": 1.56}, {"dt": "2026-02-14T12:19:20+00:00", "min": 1, "moy": 1.27, "max": 1.53}, {"dt": "2026-02-14T13:19:24+00:00", "min": 0.97, "moy": 1.25, "max": 1.5}, {"dt": "2026-02-14T14:19:28+00:00", "min": 0.95, "moy": 1.22, "max": 1.48}]};
const SEUIL = 2.0;

// Parse
const obs = obsData.map(o => ({ x: new Date(o.dt), y: o.level }));
const prevMoy = prevData.prevs.map(p => ({ x: new Date(p.dt), y: p.moy }));
const prevMin = prevData.prevs.map(p => ({ x: new Date(p.dt), y: p.min }));
const prevMax = prevData.prevs.map(p => ({ x: new Date(p.dt), y: p.max }));

// Header
const last = obs[obs.length - 1];
const prev6 = obs[Math.max(0, obs.length - 7)];
const trend = last.y > prev6.y + 0.02 ? '↗' : last.y < prev6.y - 0.02 ? '↘' : '→';
const tc = trend === '↗' ? 'trend-up' : trend === '↘' ? 'trend-down' : 'trend-stable';

const fmt = (d) => new Date(d).toLocaleString('fr-FR', { day:'2-digit', month:'2-digit', hour:'2-digit', minute:'2-digit', timeZone:'Europe/Paris' });

document.getElementById('currentLevel').innerHTML = last.y.toFixed(2) + 'm <span class="trend ' + tc + '">' + trend + '</span>';
document.getElementById('lastObs').textContent = fmt(last.x);
document.getElementById('lastSimul').textContent = fmt(prevData.dt_prod);

const badge = document.getElementById('statusBadge');
const maxPrev = Math.max(...prevData.prevs.map(p => p.max));
if (last.y >= SEUIL || maxPrev >= SEUIL) {
    badge.className = 'status-badge status-alert'; badge.textContent = 'Surveillance';
} else if (last.y >= 1.80 || maxPrev >= 1.80) {
    badge.className = 'status-badge status-vigilance'; badge.textContent = 'Vigilance';
} else {
    badge.className = 'status-badge status-normal'; badge.textContent = 'Normal';
}

// Chart
const allDates = [...obs.map(d => d.x), ...prevMoy.map(d => d.x)];
new Chart(document.getElementById('chart'), {
    type: 'line',
    data: {
        datasets: [
            { label:'Observations', data:obs, borderColor:'#4ecdc4', borderWidth:2.5, pointRadius:0, pointHitRadius:10, tension:0.3, order:1 },
            { label:'Prévision moy.', data:prevMoy, borderColor:'rgba(78,205,196,0.6)', borderWidth:2, borderDash:[8,4], pointRadius:0, tension:0.3, order:2 },
            { label:'Prev max', data:prevMax, borderColor:'transparent', backgroundColor:'rgba(78,205,196,0.12)', pointRadius:0, fill:'+1', tension:0.3, order:3 },
            { label:'Prev min', data:prevMin, borderColor:'transparent', backgroundColor:'rgba(78,205,196,0.12)', pointRadius:0, fill:false, tension:0.3, order:4 }
        ]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        interaction: { mode:'index', intersect:false },
        plugins: {
            legend: { display:false },
            tooltip: {
                backgroundColor:'rgba(15,25,35,0.95)', titleColor:'#8899aa', bodyColor:'#e0e6ed',
                borderColor:'#2a3a4a', borderWidth:1, padding:12, displayColors:false,
                callbacks: {
                    title: (items) => fmt(items[0].parsed.x),
                    label: (item) => {
                        if (item.dataset.label.startsWith('Prev ')) return null;
                        return item.dataset.label + ' : ' + item.parsed.y.toFixed(2) + 'm';
                    }
                }
            }
        },
        scales: {
            x: {
                type:'time', time:{ unit:'hour', stepSize:6, displayFormats:{ hour:'dd/MM HH:mm' } },
                grid:{ color:'rgba(255,255,255,0.04)' },
                ticks:{ color:'#5a6a7a', maxRotation:45, font:{ size:11 } },
                min: new Date(Math.min(...allDates)), max: new Date(Math.max(...allDates))
            },
            y: {
                grid:{ color:'rgba(255,255,255,0.06)' },
                ticks:{ color:'#5a6a7a', callback: v => v.toFixed(1)+'m', font:{ size:11 } },
                suggestedMin: 0,
                suggestedMax: Math.max(SEUIL + 0.3, maxPrev + 0.2)
            }
        }
    },
    plugins: [{
        id: 'seuil',
        afterDraw(chart) {
            const { ctx, chartArea, scales } = chart;
            const y = scales.y.getPixelForValue(SEUIL);
            if (y >= chartArea.top && y <= chartArea.bottom) {
                ctx.save();
                ctx.strokeStyle = 'rgba(255,107,53,0.5)';
                ctx.lineWidth = 1.5;
                ctx.setLineDash([6,4]);
                ctx.beginPath();
                ctx.moveTo(chartArea.left, y);
                ctx.lineTo(chartArea.right, y);
                ctx.stroke();
                ctx.fillStyle = 'rgba(255,107,53,0.7)';
                ctx.font = '11px -apple-system, sans-serif';
                ctx.fillText('2.00m — Surveillance', chartArea.right - 160, y - 6);
                ctx.restore();
            }
        }
    }]
});
</script>
</body>
</html>